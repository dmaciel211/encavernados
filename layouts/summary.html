{{/* layouts/_default/summary.html */}}
<article class="post-summary">
  {{- $default := .Site.Params.defaultCover | default "/media/default-cover.webp" -}}
  {{- $coverTrim := .Params.cover | default "" | strings.TrimSpace -}}
  {{- $ytTrim := .Params.youtube | default "" | strings.TrimSpace -}}
  {{- $ytid := "" -}}
  {{- if $ytTrim -}}
    {{- if hasPrefix (lower $ytTrim) "http" -}}
      {{- $ytid = replaceRE `.*(?:v=|be/|embed/)([A-Za-z0-9_-]{11}).*` "$1" $ytTrim -}}
    {{- else -}}
      {{- $ytid = $ytTrim -}}
    {{- end -}}
    {{- if ne (len $ytid) 11 -}}
      {{- $ytid = "" -}}
    {{- end -}}
  {{- end -}}

  {{- $coverData := dict -}}
  {{- $coverKey := "summary-cover" -}}
  {{- $_ := .Scratch.Delete $coverKey -}}
  {{- if not $ytid -}}
    {{- partial "function/cover-image.html" (dict
        "Page" .
        "Cover" $coverTrim
        "Default" $default
        "Quality" 75
        "Sizes" "(min-width: 768px) 360px, 100vw"
        "Widths" (slice 320 480 640 750 960)
        "Scratch" .Scratch
        "Key" $coverKey
      ) -}}
    {{- $coverData = .Scratch.Get $coverKey | default dict -}}
  {{- end -}}

  {{- if $ytid }}
    <a href="{{ .RelPermalink }}">
      <img class="post-cover"
           src="{{ printf "https://img.youtube.com/vi/%s/hqdefault.jpg" $ytid | safeURL }}"
           alt="{{ .Title }}"
           loading="lazy">
    </a>
  {{- else if $coverData.src }}
    <a href="{{ .RelPermalink }}">
      {{- if $coverData.isResource -}}
        <picture>
          <source type="image/webp"
                  srcset="{{ $coverData.srcsetWebp }}"
                  sizes="{{ $coverData.sizes }}">
          <source srcset="{{ $coverData.srcset }}"
                  sizes="{{ $coverData.sizes }}">
          <img class="post-cover"
               src="{{ $coverData.src | safeURL }}"
               srcset="{{ $coverData.srcset }}"
               sizes="{{ $coverData.sizes }}"
               width="{{ $coverData.width }}"
               height="{{ $coverData.height }}"
               alt="{{ $coverData.alt }}"
               loading="lazy"
               decoding="async">
        </picture>
      {{- else -}}
        <img class="post-cover"
             src="{{ $coverData.src | safeURL }}"
             alt="{{ $coverData.alt }}"
             loading="lazy"
             onerror="this.onerror=null;this.src='{{ $default | safeURL }}'">
      {{- end -}}
    </a>
  {{- end }}

  <div class="post-text">
    <h2><a href="{{ .RelPermalink }}">{{ .Title }}</a></h2>

    {{ with .Params.authors }}
      <p class="post-author">
        Por&nbsp;
        {{- $n := sub (len .) 1 -}}
        {{- range $i, $a := . -}}
          <a href="/authors/{{ $a | urlize }}">{{ $a }}</a>{{ if lt $i $n }}, {{ end }}
        {{- end -}}
      </p>
    {{ end }}

    {{ with .Params.description }}
      <p class="post-description">{{ . | truncate 160 }}</p>
    {{ else }}
      <p class="post-description">{{ .Summary | truncate 160 }}</p>
    {{ end }}

    <a href="{{ .RelPermalink }}" class="read-more">Leer más →</a>
  </div>
</article>
