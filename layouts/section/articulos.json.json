{{- $items := .RegularPages.ByDate.Reverse -}}
[
{{- $first := true -}}
{{- range $p := $items -}}
  {{- if not $first }},{{ end -}}
  {{- $first = false -}}

  {{- $raw := ($p.Params.cover | default "") | strings.TrimSpace -}}
  {{- $default := $p.Site.Params.defaultCover | default "/media/default-cover.webp" -}}
  {{- $yt := ($p.Params.youtube | default "") | strings.TrimSpace -}}
  {{- $key := "cover-json" -}}
  {{- $_ := $p.Scratch.Delete $key -}}
  {{- partial "function/cover-image.html" (dict
      "Page" $p
      "Cover" $raw
      "Default" $default
      "Quality" 70
      "Sizes" "(min-width: 768px) 320px, 100vw"
      "Widths" (slice 320 480 640 800)
      "Scratch" $p.Scratch
      "Key" $key
    ) -}}
  {{- $coverData := $p.Scratch.Get $key | default dict -}}
  {{- $cover := "" -}}
  {{- if $yt -}}
    {{- $cover = $yt -}}
  {{- else if $coverData.src -}}
    {{- $cover = $coverData.src -}}
  {{- end -}}

  {
    "title": {{ $p.Title | jsonify }},
    "debug": "articulos-json-v3",  <!-- ðŸ‘ˆ marcador -->
    "permalink": {{ $p.RelPermalink | jsonify }},
    "date": {{ $p.Date.Format "2006-01-02" | jsonify }},
    "author": {{ (delimit ($p.Params.authors | default (slice)) ", ") | jsonify }},
    "categories": {{ if $p.Params.categories }}{{ $p.Params.categories | jsonify }}{{ else }}[]{{ end }},
    "tags": {{ if $p.Params.tags }}{{ $p.Params.tags | jsonify }}{{ else }}[]{{ end }},
    "cover": {{ if $cover }}{{ $cover | jsonify }}{{ else }}null{{ end }},
    "youtube": {{ $yt | jsonify }},
    "summary": {{ with $p.Params.description }}{{ . | plainify | truncate 160 | jsonify }}{{ else }}{{ $p.Summary | plainify | truncate 160 | jsonify }}{{ end }}
  }
{{- end -}}
]
