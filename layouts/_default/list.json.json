{{- $items := .Pages.ByDate.Reverse -}}
[
{{- $first := true -}}
{{- range $p := $items -}}
  {{- if not $first }},{{ end -}}
  {{- $first = false -}}
  {{- $raw := $p.Params.cover | default "" -}}
  {{- $cover := "" -}}
  {{- if $raw -}}
    {{- if or (hasPrefix (lower $raw) "http") (hasPrefix $raw "/") -}}
      {{- $cover = $raw -}}
    {{- else -}}
      {{- $cover = printf "/media/%s" $raw -}}
    {{- end -}}
  {{- end -}}
  {
    "title": {{ $p.Title | jsonify }},
    "permalink": {{ $p.RelPermalink | jsonify }},
    "date": {{ $p.Date.Format "2006-01-02" | jsonify }},
    "author": {{ (delimit ($p.Params.authors | default (slice)) ", ") | jsonify }},
    "categories": {{ if $p.Params.categories }}{{ $p.Params.categories | jsonify }}{{ else }}[]{{ end }},
    "tags": {{ if $p.Params.tags }}{{ $p.Params.tags | jsonify }}{{ else }}[]{{ end }},
    "cover": {{ if $cover }}{{ $cover | jsonify }}{{ else }}null{{ end }},
    "youtube": {{ ($p.Params.youtube | default "") | jsonify }},
    "summary": {{ with $p.Params.description }}{{ . | plainify | truncate 160 | jsonify }}{{ else }}{{ $p.Summary | plainify | truncate 160 | jsonify }}{{ end }}
  }
{{- end -}}
]
