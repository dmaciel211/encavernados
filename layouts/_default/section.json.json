{{- $section := lower .Section -}}
{{- $categorySections := slice "articulos" "entrevistas" "reflexiones" -}}
{{- if in $categorySections $section -}}
  {{- $posts := slice -}}
  {{- range (where .Site.RegularPages "Section" "articulos").ByDate.Reverse -}}
    {{- $cats := .Params.categories -}}
    {{- $typ := printf "%T" $cats -}}
    {{- $match := false -}}
    {{- if eq $typ "string" -}}
      {{- $match = eq (lower (printf "%v" $cats)) $section -}}
    {{- else if or (eq $typ "[]string") (eq $typ "[]interface {}") -}}
      {{- range $c := $cats -}}
        {{- if eq (lower (printf "%v" $c)) $section -}}
          {{- $match = true -}}
        {{- end -}}
      {{- end -}}
    {{- end -}}
    {{- if $match -}}
      {{- $posts = $posts | append . -}}
    {{- end -}}
  {{- end -}}
  [
  {{- $first := true -}}
  {{- range $p := $posts -}}
    {{- if not $first }},{{ end -}}
    {{- $first = false -}}
    {{- $raw := $p.Params.cover | default "" -}}
    {{- $cover := "" -}}
    {{- if $raw -}}
      {{- if or (hasPrefix (lower $raw) "http") (hasPrefix $raw "/") -}}
        {{- $cover = $raw -}}
      {{- else -}}
        {{- $cover = printf "/media/%s" $raw -}}
      {{- end -}}
    {{- end -}}
    {
      "title": {{ $p.Title | jsonify }},
      "permalink": {{ $p.RelPermalink | jsonify }},
      "date": {{ $p.Date.Format "2006-01-02" | jsonify }},
      "author": {{ (delimit ($p.Params.authors | default (slice)) ", ") | jsonify }},
      "categories": {{ if $p.Params.categories }}{{ $p.Params.categories | jsonify }}{{ else }}[]{{ end }},
      "tags": {{ if $p.Params.tags }}{{ $p.Params.tags | jsonify }}{{ else }}[]{{ end }},
      "cover": {{ if $cover }}{{ $cover | jsonify }}{{ else }}null{{ end }},
      "youtube": {{ ($p.Params.youtube | default "") | jsonify }},
      "summary": {{ with $p.Params.description }}{{ . | plainify | truncate 160 | jsonify }}{{ else }}{{ $p.Summary | plainify | truncate 160 | jsonify }}{{ end }}
    }
  {{- end -}}
  ]
{{- else -}}
  {{- $items := .Pages.ByDate.Reverse -}}
  [
  {{- $first := true -}}
  {{- range $p := $items -}}
    {{- if not $first }},{{ end -}}
    {{- $first = false -}}
    {
      "title": {{ $p.Title | jsonify }},
      "permalink": {{ $p.RelPermalink | jsonify }},
      "date": {{ $p.Date.Format "2006-01-02" | jsonify }}
    }
  {{- end -}}
  ]
{{- end -}}
